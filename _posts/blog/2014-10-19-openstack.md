---
layout: post
title: Openstack中调度器的实现算法
description: 在开设虚拟机时openstack里面的调度器需要选择一台合适的计算节点，然后把虚拟机部署上去，而这个调度器究竟内部用到了什么算法呢？
category: blog
---
#openstack中调度器的实现算法 
>在开设虚拟机时openstack里面的调度器需要选择一台合适的计算节点，然后把虚拟机部署上去，而这个调度器究竟内部用到了什么算法呢？

![Alt text](http://xuchanggui.github.io/images//11.jpg)

```
由于虚拟机是运行在计算节点上的，所以当AMQP中的schedule队列有消息时，
控制节点中的nova-schedule监听到消息后 获取队列里面的消息，然后调度器schedule开始出场了，
需要说明的是Nova里面默认的调度器是multischedule也就是多重调度器，是好几个不同的调度器的组合，
它会根据不同的消息选用不同的调度器，对于创建虚拟机这种类型的消息，则会选用filterschedule调度器，
这个调度器顾名思义就是有过滤功能的一个调度器，并且openstack约定只有对于创建虚拟机的这种消息才使用这个过滤调度器，
对于像volume这样的消息就使用其他的调度器，好了言归正传，当选择这个调度器后，就将进行下面的两个操作：过滤，权衡。
```
-----
```
过滤的具体操作去下：
首先是计算出可用的计算节点集合，这个过程是这样的
：首先需要知道的是每个计算节点在Nova的一个数据库表中都有一个记录，
这个记录是这个计算节点的所有可供使用的资源信息（如cpu，内存，硬盘，网络等），
当把一这个表中关于计算节点的记录读取出来后，再去读取数据库中已经创建的虚拟机的信息，
然后用每一个计算节点的总资源减去虚拟机实例的资源得到的就是可用的计算节点资源，
把所有都这么操作一下就得到了一个可用计算节点集合 ，好了现在已经得到了可用计算节点的集合
，下一步就是选择一个过滤器（Nova实现了好多种过滤器）对这些可用节点集合进行一个筛选，
筛选方式有很多这里就不一一介绍了，筛选完了后就进去下一个重要的阶段：
权衡，权衡就是根据请求创建的虚拟机要求的资源和经过筛选后的计算节点资源之间的适合的度
，来决定使用哪一台物理主机。程序中的实现是通过两个方面来实现的，一个是权衡因子，这是权重值
。在权衡之前nova就已经创建好了一个权衡因子和成本计算函数组合的一个列表，所以计算权重值的时候就先读取这个列表，
然后选择一个成本计算函数，计算出在每个不同的计算节点上的权重值，
在不考虑权衡因子的情况下，主机的权重值越小，表明越适合在改主机上开设虚拟机，
成本计算函数返回的是一个计算节点剩余内存的大小，此时权衡因子开始起作用了，
当权衡因子为负数时表明该计算节点空间快要饱和，即使此时主机的权重值很小
，Nova也会选择其他的内存大的节点上去开设虚拟机，
同样如果权衡因子为正数表明该计算节点剩余空间很大，
即使该节点的权重值比较大也会把虚拟机开设到这上面去，
这样做的目的是为了负载均衡 它是从整个计算节点集合的角度去考虑的，
至此整个Nova调度器内部过程就是这样的。
```
```
function  fun(){
    alert("thank you look at this article");
}
```

@*我分享我分享我快乐。*[更多了解](http://www.360doc.com/content/13/1023/15/8504707_323527638.shtml)
